
















<!DOCTYPE html>
<html lang='en-us'><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <link rel="shortcut icon" href='http://localhost:1313/favicon.ico' type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Metamorphic Malware</title>

    

    

    

    
        <meta property="og:url" content="http://localhost:1313/blog/metamorphic-malware/">
  <meta property="og:site_name" content="Home">
  <meta property="og:title" content="Metamorphic Malware">
  <meta property="og:description" content="Metamorphic or self-modifying code is an advanced technique used by virus and malware authors which enables their malicious program to rewrite itself in a way that the code remains functionally equivalent but looks different each time it is executed. This characteristic prevents antivirus software from detecting the malware using static signatures and makes reverse engineering more difficult.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2024-07-29T17:31:56+02:00">
    <meta property="article:modified_time" content="2024-07-29T17:31:56+02:00">

    

    
        
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Metamorphic Malware">
  <meta name="twitter:description" content="Metamorphic or self-modifying code is an advanced technique used by virus and malware authors which enables their malicious program to rewrite itself in a way that the code remains functionally equivalent but looks different each time it is executed. This characteristic prevents antivirus software from detecting the malware using static signatures and makes reverse engineering more difficult.">

    <link rel="stylesheet" href="/style.css" integrity="">





    
    <script>
        if (!('theme' in localStorage)) {
            localStorage.theme = 'dark';
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute("data-theme", "dark");
        } else {
            document.documentElement.setAttribute("data-theme", "light");
        }
    </script>
<script defer src="/js/header.js" integrity=""></script>



    <script defer src="/js/zooming.js" integrity=""></script>









    
    
    
    <script defer src="/js/search-en-us.js" integrity=""></script>




<link rel="stylesheet" href="http://localhost:1313/user.css">

    
</head>
<body><header>
    <div id="header_left">
        <div id="sidebar_btn">
            <input type="checkbox" id="sidebar_btn_input" class="hidden" />
            <label id="sidebar_btn_label" for="sidebar_btn_input">
                <svg id="menu_icon" width="26px" height="26px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
</svg>

</svg>
            </label>
            <label id="sidebar_canvas_overlay_wrapper" for="sidebar_btn_input">
                <div id="sidebar_canvas_overlay"></div>
            </label>
            <div id="sidebar">
                <ul><li>
                            <a href="/blog/">Blog</a></li><li>
                            <a href="/categories/">Categories</a></li><li>
                            <a href="/about/">About</a></li><li>
                            <a href="/"></a></li></ul>
            </div>
        </div>
    
        <div class="brand">
            <div>
                <a href="/">Home</a>
            </div>
        </div>
    </div>

    <div class="toolbox"><nav id="navbar" class="pure-menu">
    <ul class="pure-menu-list"><li class="navbar-item pure-menu-item insection">
                    
                        <a href="/blog/" class="pure-menu-link">Blog</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/categories/" class="pure-menu-link">Categories</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/about/" class="pure-menu-link">About</a>
                    
                </li><li class="navbar-item pure-menu-item ">
                    
                        <a href="/" class="pure-menu-link"></a>
                    
                </li></ul>
</nav>
<div id="theme_tool">
            <svg id="dark_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
</svg>

</svg>
            <svg id="light_mode_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
</svg>

</svg>
        </div>

        
            <div id="search_tool">
                <svg id="search_btn" class="toolbox-btn" width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
</svg>

</svg><div id="search_menu_wrapper" class="hidden">
    <div id="search_menu">
        <div id="search_menu_toolbar">
            <div id="search_menu_input_wrapper">
                <input id="search_menu_input" type="text" placeholder='Search Posts'>
            </div>
            <div id="search_menu_close_btn">
                <svg width="18px" height="18px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
</svg>

</svg>
            </div>
        </div>
        <div id="search_menu_results">
        </div>
    </div>
</div>
</div>
        
 
    </div>
</header>
<main>
            <div id="content" class="content-margin">
                

<details class="collapsible-menu-wrapper"><summary class="collapsible-menu-type"><span>Table of contents</span></summary><div class="collapsible-menu">
        
            <nav id="TableOfContents">
  <ul>
    <li><a href="#metamorphism-vs-polymorphism">Metamorphism vs Polymorphism</a></li>
    <li><a href="#the-metamorphic-engine">The Metamorphic Engine</a>
      <ul>
        <li><a href="#disassembler">Disassembler</a></li>
        <li><a href="#shrinker">Shrinker</a></li>
        <li><a href="#permutator">Permutator</a></li>
        <li><a href="#expander">Expander</a></li>
        <li><a href="#assembler">Assembler</a></li>
      </ul>
    </li>
    <li><a href="#detection">Detection</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        
    </div></details>




    <h1>Metamorphic Malware</h1>

    <div class="blog-post-meta">
        
            <span class="date">July 29, 2024</span>
        
    
        
            <span> â€¢ </span>
             
 <span class="blog-meta-category">
    <a href="/categories/malware-development/">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>

<span>malware-development</span></a>
</span>
        
    </div>


<div class="blog-body">

    
        <h2 class="blog-introduction-header">Introduction</h2>
    
    
    
    <div class="content-margin">



<article class="line-numbers">
    
    
    <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Metamorphic or self-modifying code is an advanced technique used by virus and malware authors which enables their malicious program to rewrite itself in a way that the code remains functionally equivalent but looks different each time it is executed. This characteristic prevents antivirus software from detecting the malware using static signatures and makes reverse engineering more difficult.</p>
<p>This article will provide an overview of metamorphic malware, the difference to polymorphic malware and how it can be implemented, by taking a look at how <em>The Mental Driller</em> from the 29A virus group structures metamorphic engines<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>

<h2 id="metamorphism-vs-polymorphism" class="header-anchor-wrapper">Metamorphism vs Polymorphism
  <a href="#metamorphism-vs-polymorphism" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>The term polymorphism in regard to malware or virus development has little to do with it&rsquo;s use in object-oriented programming. Instead, polymorphic malware can change its signature by generating and using a mutation engine that generates a new decryption routine for each generation of the virus. After the initial virus body is decrypted, the decryption routine is mutated and the virus body as well as the decryptor are encrypted again, before being linked together for the next iteration<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. The downside of this approach is obvious: the decrypted virus body does not change and can therefore be detected and flagged by antivirus software, which is the reason why metamorphic engines came into existence.</p>
<p>Metamorphism can be defined as <em>body-polymorphism</em><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>. Instead of having a constant virus body, a metamorphic engine is able to create new generations of the virus which are functionally equivalent but look different for every new infection. It&rsquo;s not just the decryptor that mutates, but everything else in the code as well. This can be achieved by using three mutation techniques:</p>
<ul>
<li><strong>Compression</strong>: The virus body is compressed by combining multiple assembly instructions into one that does the same thing. This step is necessary to avoid the malware from growing too large in size.</li>
<li><strong>Permutation</strong>: Intstructions are permuted by changing the order or by replacing them with equivalent instructions.</li>
<li><strong>Expansion</strong>:  Instructions are rewritten into multiple instructions that do the same thing and insert dead code that adds not functionality. This technique is only used if compression is present, since the virus code would grow uncontrollably otherwise.</li>
</ul>
<p>While the permutation aspect is usually present in most metamorphic engines, the others are used to a lesser extent, due to the difficulty of implementing the compression code. According to The Mental Driller, the <em>Accordion</em> model (compression &amp; expansion) in combination with permutation generates <em>absolute metamorphism</em>, which means that code skeleton changes but not the algorithm<sup id="fnref1:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>

<h2 id="the-metamorphic-engine" class="header-anchor-wrapper">The Metamorphic Engine
  <a href="#the-metamorphic-engine" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>The metamorphic engine is the core part of a metamorphic virus that is responsible for the mutation of the virus body. It takes of more than 90% percent of the virus code, with the remaining part being the infector itself. The structure of the engine was described by The Mental Driller in 2002 but can still be applied to modern metamorphic malware. It incorporates the mutation techniques mentioned above in the shrinker, permutator and expander components and further includes a disassembler and assembler.</p>
<p>












<figure class=" img-dark">
    <div>
        <img loading="lazy" alt="Structure of metamorphic code" src=" /img/metamorphic_malware/metamorphic-engine-dark.png#dark">
    </div>
    
</figure>













<figure class=" img-light">
    <div>
        <img loading="lazy" alt="Structure of metamorphic code" src=" /img/metamorphic_malware/metamorphic-engine-light.png#light">
    </div>
    
</figure></p>
<p>The following sections will provide a brief overview of each component of the engine. In particular, this article will focus on <em>MetaPHOR</em><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> (metamorphic permutating high-obfuscating reassembler), also known as <em>W32/Simile</em><sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> by The Mental Driller. The replication mechanism of the virus is out of scope for this blog post but can be read about <a href="https://www.informit.com/articles/article.aspx?p=366890&amp;seqNum=6">here</a>.</p>

<h3 id="disassembler" class="header-anchor-wrapper">Disassembler
  <a href="#disassembler" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h3>

<p>In order to mutate itself, the malware first needs to disassemble itself into a pseudo-assembly language that is created by the malware author. However, The Mental Driller suggests basing the pseudo-assembly language on x86 opcodes in order to simplify the handling. The secondary characteristic of the disassembler is the ability to decode <code>jmp</code> or <code>call</code> instructions. A memory buffer is used to store the already-disassembled code, while two tables are used to store pointers to the disassembled code and the destinations of <code>jmp</code>, <code>call</code> and other similar instructions. While this article will not go into in-depth detail of the disassembler&rsquo;s algorithm, it eventually achieves the following goals:</p>
<ul>
<li>Eliminating permutation and permutation jumps</li>
<li>Eliminating unreachable code</li>
<li>Decoding the program into a pseudo-assembly language</li>
<li>Substituting labels with pointers to table entries</li>
</ul>

<h3 id="shrinker" class="header-anchor-wrapper">Shrinker
  <a href="#shrinker" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h3>

<p>After the code has been disassembled, the shrinker takes caro of compressing known pairs or triplets of instructions into a single one. This is mainly done to reduce the size of the malware and to undo the results of the expander. The program needs to define a table of possible combinations that can be compressed or even eliminated.</p>
<table class="mc-table">
  <thead>
      <tr>
          <th style="text-align: left"><strong>Original Instruction</strong></th>
          <th style="text-align: left"><strong>Compressed Instruction</strong></th>
          <th style="text-align: left"><strong>Explanation</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>MOV reg, reg</code></td>
          <td style="text-align: left"><code>NOP</code></td>
          <td style="text-align: left">Nothing happens</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>XOR reg, reg</code></td>
          <td style="text-align: left"><code>MOV reg, 0</code></td>
          <td style="text-align: left">Sets the registry to 0</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>SUB reg, reg</code></td>
          <td style="text-align: left"><code>MOV reg, 0</code></td>
          <td style="text-align: left">Sets the registry to 0</td>
      </tr>
  </tbody>
</table>
<p>As can be seen in the table above, the shrinker also aims to keep the amount of different instructions to a minimum, which is why both the <code>xor</code> and <code>sub</code> instruction are compressed to a <code>mov</code> instruction.</p>
<p>Of course, the shrinker not only replaces single instructions but also sets of instructions. A small excerpt is shown below.</p>
<table class="mc-table">
  <thead>
      <tr>
          <th style="text-align: left"><code>MOV addr, reg</code> and <code>PUSH addr</code></th>
          <th style="text-align: left"><code>PUSH reg</code></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>MOV addr2, addr1</code> and <code>MOV addr3, addr2</code></td>
          <td style="text-align: left"><code>MOV addr3, addr1</code></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>MOV reg, val</code> and <code>ADD reg, reg2</code></td>
          <td style="text-align: left"><code>LEA reg,[reg2 + val]</code></td>
      </tr>
  </tbody>
</table>
<p>When a matching pair or triplet is found, the shrinker replaces the first instruction with the compressed one and overwrites the following instructions with <code>NOP</code> instructions, successfully compressing it.</p>

<h3 id="permutator" class="header-anchor-wrapper">Permutator
  <a href="#permutator" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h3>

<p>The permutator is responsible for changing the order of instructions in the code, which is done by shuffling. By leaving in the <code>nop</code> instructions from the shrinker in this step, the permutator will derive a more random code structure, since the <code>nop</code> instructions are included in the permutation, but removed in further steps. The permutator can also be combined with other forms of metamorphism, such as substitution, which replaces instructions with equivalent ones.</p>

<h3 id="expander" class="header-anchor-wrapper">Expander
  <a href="#expander" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h3>

<p>At this point, the code has been compressed and permuted, which means that the code is now smaller and has a different structure. Now, the expander basically does the opposite of the shrinker: it recursively replaces single instructions randomly with matching single, pair or triplet instruction sets. Of course, a control variable is put in place to prevent the code from growing too much. Apart from the obvious expansion, the expander has additional characteristics, like register translation, which means that the registers are shuffled and never the same in different generations.</p>
<p>The expander is normally only implemented if the shrinker is implemented as well, as the code would grow uncontrollably without a compression mechanism.</p>

<h3 id="assembler" class="header-anchor-wrapper">Assembler
  <a href="#assembler" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h3>

<p>Last but not least, the assembler is responsible for converting the mutated pseudo-assembly language back into machine code that the processor can understand. The assembler fixes <code>jmp</code>, <code>call</code> and similar instructions, changes registers and fixes instruction lengths, before reassembling the code into the target processor language.</p>
<p>After the assembler has done its job, the metamorphic engine has successfully mutated the virus body and the hard part begins: <em>the debugging</em>. Debugging metamorphic code is problematic, since the mutated code is obfuscated and difficult to understand.</p>
<p>This marks the end of the components that The Mental Driller has described in his article about MetaPHOR. It has to be said that these are not the only metamorphic techniques that exist and that there are of course countless other ways to implement a metamorphic engine.</p>

<h2 id="detection" class="header-anchor-wrapper">Detection
  <a href="#detection" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>Despite it&rsquo;s sophistication, metamorphic malware is by no means undetectable. Possible detection techniques include:</p>
<ul>
<li>Behavioral Analysis</li>
<li>Heuristic-based Detection</li>
<li>Emulation or VM-Sandboxing</li>
<li>Geometric Detection<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup></li>
<li>Machine Learning<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup></li>
</ul>
<p>According to researcher Philippe Beaucamps, who thoroughly studied and analyzed The Mental Driller&rsquo;s MetaPHOR, the virus can be detected using statistical analysis of the code and monitoring of the memory during program execution. This is because the virus compresses itself into a form which is similar between generation. Furthermore, The Mental Driller has not implemented evasion techniques that protect against behavioral analysis<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>. However, the researcher also states that antivirus companies can be swiftly overtaken if refined metamorphic techniques were to be used by virus authors and malware developers.</p>

<h2 id="conclusion" class="header-anchor-wrapper">Conclusion
  <a href="#conclusion" class="header-anchor-link">
    <svg width="16px" height="16px" viewBox="0 0 24 24">
<svg
    xmlns="http://www.w3.org/2000/svg"
    width="24" height="24" viewBox="0 0 24 24" fill="none"
    stroke="currentColor" stroke-width="2" stroke-linecap="round"
    stroke-linejoin="round">
    <line x1="4" y1="9" x2="20" y2="9"></line><line x1="4" y1="15" x2="20" y2="15"></line><line x1="10" y1="3" x2="8" y2="21"></line><line x1="16" y1="3" x2="14" y2="21"></line>
</svg>

</svg>
  </a>
</h2>

<p>Summing up, metamorphism is an advanced and highly sophisticated technique used by malware authors to evade static detection through signature-based antivirus software. Due to the complexity of the metamorphic engine, the code is difficult to implement, debug and reverse engineer, resulting in a shortage of research and well-developed practical examples. The Mental Driller showcased the generic structure of a metamorphic engine in his article about MetaPHOR, consisting of a disassembler, shrinker, permutator, expander and assembler. By combining the permutator with the so-called &ldquo;Accordion&rdquo; model, MetaPHOR achieved what the author called absolute metamorphism. The result is a virus that is functionally equivalent but looks different each time it infects a new host.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Metamorphism in practice or &ldquo;How I made MetaPHOR and what I&rsquo;ve learnt&rdquo;, <a href="https://vxug.fakedoma.in/archive/VxHeaven/lib/vmd01.html">https://vxug.fakedoma.in/archive/VxHeaven/lib/vmd01.html</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Metamorphic Malware and Obfuscation: A Survey of Techniques, Variants, and Generation Kits, <a href="https://onlinelibrary.wiley.com/doi/10.1155/2023/8227751">https://onlinelibrary.wiley.com/doi/10.1155/2023/8227751</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Advanced Code Evolution Techniques and Computer Virus Generator Kits: <a href="https://www.informit.com/articles/article.aspx?p=366890&amp;seqNum=6">https://www.informit.com/articles/article.aspx?p=366890&amp;seqNum=6</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>MetaPHOR source code: <a href="https://github.com/mal-project/win32.MetaPHOR">https://github.com/mal-project/win32.MetaPHOR</a>&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Simile: <a href="https://en.wikipedia.org/wiki/Simile_(computer_virus)">https://en.wikipedia.org/wiki/Simile_(computer_virus)</a>&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Hunting for Metamorphic: <a href="https://harrisonwl.github.io/assets/courses/malware/spring2017/papers/HuntingMetamorphic.pdf">https://harrisonwl.github.io/assets/courses/malware/spring2017/papers/HuntingMetamorphic.pdf</a>&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>Understanding Metamorphic Code: <a href="https://dev.to/khairuaqsara/understanding-metamorphic-code-3g7">https://dev.to/khairuaqsara/understanding-metamorphic-code-3g7</a>&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p>Advanced Metamorphic Techniques in Computer Viruses: <a href="https://inria.hal.science/inria-00338066/document">https://inria.hal.science/inria-00338066/document</a>&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article></div>
    
</div>


    
<div class="blog-footer">
    <div class="icon">
        <a href="https://github.com/jakobfriedl" target="_blank">
            
<svg
    xmlns="http://www.w3.org/2000/svg"
    role="img" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
    <title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
</svg>


        </a>
    </div>
    <div class="icon">
        <a href="https://linkedin.com/in/jakobfriedl" target="_blank" class="icon">
            
<svg
    xmlns="http://www.w3.org/2000/svg"
    role="img" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
    <title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
</svg>


        </a>
    </div>
    <div class="icon">    
        <a href="https://x.com/virtualloc" target="_blank" class="icon">
            
<svg
    xmlns="http://www.w3.org/2000/svg"
    role="img" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
    <title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/>
</svg>


        </a>
    </div>
    <div class="icon">    
        <a href="/index.xml" target="_blank" class="icon">
            
<svg
    xmlns="http://www.w3.org/2000/svg"
    role="img" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
    <title>RSS</title><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/>
</svg>


        </a>
    </div>
</div>



                
                    
                
            </div>
        </main>
<footer>
    <article>Jakob Friedl Â© 2024</article>
</footer>

</body>
</html>
